@using shop.Data
@{
    Layout = null;
    var frontProducts = ViewBag.FrontProducts as List<Product>;
    var categories = ViewBag.Categories as List<Category>;
    var categoryId = ViewBag.CategoryId as int?;
    var isAuthenticated = User.Identity != null && User.Identity.IsAuthenticated;
    var isAdmin = User.IsInRole("admin");
    var hasMatched = ViewBag.HasMatched as bool?;
    var howMany = ViewBag.HowMany as int?;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sklep - Strona główna</title>
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>

<header>
    <div>
        @if (isAuthenticated)
        {
            @Html.ActionLink("Shopping Cart", "Cart", "ShoppingCart")
        }
    </div>
    <div>
        @if (!isAuthenticated)
        {
            @Html.ActionLink("Logowanie", "Login", "Account", new { categoryId = ViewBag.CategoryId }, new { style = "margin-left: 10px;" })
            @Html.ActionLink("Rejestracja", "Register", "Account", new { categoryId = categoryId }, new { style = "margin-left: 10px;" })
        }
        else
        {
            <span>Witaj, @User.Identity.Name!</span>
            @Html.ActionLink("Wyloguj", "Logout", "Account", new { categoryId }, new { style = "margin-left: 10px;" })
        }
    </div>
</header>

@if (isAdmin)
{
    @Html.Partial("_AdminControlPanel")
}

<!-- Wybór kategorii -->
<div class="category-selector">
    <select onchange="window.location.href='/Home/Index?categoryId=' + this.value">
        <option value="">Example Products</option>
        @foreach (var category in categories)
        {
            <option value="@category.id" @(categoryId == category.id ? "selected" : "")>@category.name</option>
        }
    </select>
</div>

<div class="search-bar">
    @using (Html.BeginForm("Search", "Home", FormMethod.Get))
    {
        @Html.TextBox("query", null, new { placeholder = "Szukaj produktu...", @class = "search-input" })
        <button type="submit" class="search-button">Szukaj</button>
    }
</div>

<div class="propositions">
    @if (frontProducts != null && frontProducts.Any())
    {
        @if (categoryId.HasValue)
        {
            <h2>Wybrana kategoria: @categories.FirstOrDefault(c => c.id == categoryId)?.name</h2>
        }
        else
        {
            <h2>Propozycje produktów</h2>
        }

        @if (hasMatched != null && !(bool)hasMatched)
        {
            <p>Brak wyników wyszukiwania.</p>
            <p>Najbardziej pasujące do Twojego zapytania:</p>
        }
        @if(hasMatched != null && (bool)hasMatched)
        {
            <p>Wyniki wyszukiwania:</p>
        }
        <!-- Wyświetlanie produktów -->
        int counter = 0;
        @foreach (var product in frontProducts)
        {
            @if (howMany != null && counter == (int)howMany)
            {
                <p>Możliwe dopasowania:</p>
            }
            <div>
                <div>
                    <span>@product.name - @product.description - @product.price</span>

                    <!-- Dodawnie do koszyka dla zalogowanych --> 
                    @if(isAuthenticated)
                    {
                        @Html.ActionLink("Add to cart", "Add", "ShoppingCart", new { productId = product.id }, null)
                    }
                    <!-- Przyciski edycji i usuwania widoczne tylko dla adminów -->
                    @if (isAdmin)
                    {
                        @Html.ActionLink("Edytuj", "EditProduct", "Admin", new { productId = product.id }, new { @class = "btn-edit", style = "margin-left: 10px;" })
                        @Html.ActionLink("Usuń", "DeleteProduct", "Admin", new { productId = product.id }, new { @class = "btn-delete", style = "margin-left: 10px;" })
                    }
                </div>
            </div>
            counter++;
        }
    }
    else
    {
        <p>Brak propozycji produktów.</p>
    }
</div>

<footer>
    Hell yeah!
</footer>

</body>
</html>
